<!doctype html>
<html
	lang="en" >
	<head>
		<title>
            Caio Raphael
		</title>
		<meta
			charset="utf-8" >
		<meta
			name="viewport" 
			content="width=device-width, initial-scale=1" >
		<meta
			name="description" 
			content="Senior Game Developer, Engine Developer, Low-Level Network, Low-Level Systems, Physicist" >
		<meta
			name="author" 
			content="Caio Raphael" >
		<meta
			name="theme-color" 
			content="#ffffff" 
			media="(prefers-color-scheme: light)" >
		<meta
			name="theme-color" 
			content="#101010" 
			media="(prefers-color-scheme: dark)" >
		<link
			rel="icon" 
			href="/assets/icon.ico" >
		<link
			rel="icon" 
			href="/assets/icon-16x16.png" 
			sizes="16x16" 
			type="image/png" >
		<link
			rel="icon" 
			href="/assets/icon-32x32.png" 
			sizes="32x32" 
			type="image/png" >
		<script>
window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    displayMath: [['$$', '$$']]
                }
                };
		</script>
		<script
			src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" >
		</script>
		<script
			type="module" >

                    import hljs from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/highlight.min.js';
                    import hljs_odin from 'https://unpkg.com/highlightjs-odinlang@1.4.0/dist/odin.es.min.js';
                    import hljs_glsl from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/languages/glsl.min.js';
                    import hljs_swift  from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/languages/swift.min.js';
                    hljs.registerLanguage('odin', hljs_odin);
                    hljs.registerLanguage('glsl', hljs_glsl);
                    hljs.registerLanguage('gdscript', hljs_swift);
                    hljs.highlightAll();
                
		</script>
		<link
			rel="stylesheet" 
			href="/static/studies.39984.css" >
	</head>
	<body>
		<aside
			id="left-sidebar-wrapper" >
			<div
				id="left-sidebar" >
				<header>
					<a
						href="/" 
						class="site-logo" >
                        Caio Raphael
					</a>
					<p
						class="breadcrums-division" >
                        /
					</p>
					<a
						href="/studies/_index.html" 
						class="breadcrumbs-studies" >
                        Studies
					</a>
				</header>
				<nav>
					<details
>
						<summary>
                            Network - Communication Protocols
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Communication Protocols/Network - Communication Protocols-tcp-transmission-control-protocol.html" >
                                    TCP (Transmission Control Protocol)
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Communication Protocols/Network - Communication Protocols-tcp-paid-services.html" >
                                    TCP - Paid Services
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Communication Protocols/Network - Communication Protocols-udp-user-datagram-protocol.html" >
                                    UDP (User Datagram Protocol)
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Communication Protocols/Network - Communication Protocols-udp-libraries.html" >
                                    UDP - Libraries
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Communication Protocols/Network - Communication Protocols-udp-paid-services.html" >
                                    UDP - Paid Services
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Communication Protocols/Network - Communication Protocols-higher-level-communication-protocols.html" >
                                    Higher Level Communication Protocols
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Network - Backend
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Backend/Network - Backend-network-architecture.html" >
                                    Network Architecture
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Backend/Network - Backend-socket.html" >
                                    Socket
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Backend/Network - Backend-security-and-authentication.html" >
                                    Security and Authentication
								</a>
							</li>
						</ul>
					</details>
					<details
						open="">
						<summary>
                            Network - Netcode
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Netcode/Network - Netcode-netcode.html" >
                                    Netcode
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Netcode/Network - Netcode-full-synchronization-with-input-lag.html" >
                                    Full Synchronization with Input Lag
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Netcode/Network - Netcode-lag-compensation.html" >
                                    Lag Compensation
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="active" 
									href="/studies/Network/Network - Netcode/Network - Netcode-correcting-wrong-states-or-predictions.html" >
                                    Correcting Wrong States (or Predictions)
								</a>
								<ul>
									<li>
										<a
											href="#replication" >
                                            Replication
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#reconciliation" >
                                            Reconciliation
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#rollback" >
                                            Rollback
										</a>
									</li>
								</ul>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Network - HTTP
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - HTTP/Network - HTTP-about.html" >
                                    About
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - HTTP/Network - HTTP-strategies.html" >
                                    Strategies
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - HTTP/Network - HTTP-structure.html" >
                                    Structure
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - HTTP/Network - HTTP-restful-representational-state-transfer-rest-api.html" >
                                    RESTful (Representational State Transfer) / REST API
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - HTTP/Network - HTTP-implementation-examples.html" >
                                    Implementation Examples
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Network - Telecom
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Telecom/Network - Telecom-notes.html" >
                                    Notes
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Telecom/Network - Telecom-hardware.html" >
                                    Hardware
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Telecom/Network - Telecom-connections-and-settings.html" >
                                    Connections and Settings
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Telecom/Network - Telecom-server.html" >
                                    Server
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Telecom/Network - Telecom-security-protocols.html" >
                                    Security Protocols
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Network - Telecom/Network - Telecom-vpn-proxy.html" >
                                    VPN / Proxy
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Encryption
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Encryption-hashing.html" >
                                    Hashing
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Encryption-security-tests-requirements-etc.html" >
                                    Security Tests / Requirements / Etc
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Web Security
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/Web Security-inspecting-site.html" >
                                    Inspecting Site
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            SSH
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Network/SSH-ssh.html" >
                                    SSH
								</a>
							</li>
						</ul>
					</details>
				</nav>
			</div>
		</aside>
		<main
			id="central-wrapper" >
			<main
				id="note-wrapper" >
				<header
					id="note-header" >
					<h1>
                        Correcting Wrong States (or Predictions)
					</h1>
					<p>
						<time
							datetime="2024-10-19" >
                            üïí Created: 2024-10-19
						</time>
						<time
							datetime="2026-02-06" >
                            | Updated: 2026-02-06
						</time>
					</p>
				</header>
				<article
					id="note-content" >
<ul>
	<li>
		<p>
            Techniques used together with Prediction.
		</p>
	</li>
</ul>
<h3
	id="replication" >
    Replication
</h3>
<ul>
	<li>
		<p>
            Replicates 
			<strong>
                data
			</strong>
            &nbsp;and 
			<strong>
                events
			</strong>
            &nbsp;occurring on the Host / Server.
		</p>
	</li>
	<li>
		<p>
            This strategy makes more sense for P2P architectures, since a dedicated server does not necessarily have information to &quot;replicate.&quot;
		</p>
	</li>
	<li>
		<p>
            I understand Replication and Reconciliation as similar in philosophy, but Reconciliation uses a Prediction model, while Replication uses replication of host P2P states and events to later resynchronize.
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://youtu.be/h47zZrqjgLc?si=b5WgE0kjyko2fYZZ&t=1599" 
				class="external-link" 
				target="_blank" >
                P2P and Netcode in Halo Reach
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    {26:39 -&gt; 35:00}
				</p>
				<ul>
					<li>
						<p>
                            Uses a latency diagram to illustrate 'grenade throwing'.
						</p>
					</li>
					<li>
						<p>
                            {32:17} Solution.
						</p>
						<ul>
							<li>
								<p>
                                    &quot;Never have input lag; if the player presses a button, they get frustrated if no immediate action happens on screen.&quot;
								</p>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    {35:00 -&gt; 44:00}
				</p>
				<ul>
					<li>
						<p>
                            Uses a latency diagram to illustrate 'Armor Lock'.
						</p>
					</li>
					<li>
						<p>
                            {41:20} Solution.
						</p>
						<ul>
							<li>
								<p>
                                    To fix, &quot;lag debt&quot; was paid on the host, so the host activated the shield earlier than it should, giving the requesting client feedback that things are happening in real-time.
								</p>
								<ul>
									<li>
										<p>
                                            This is interesting because it modifies mechanics on the host to cancel the perception of latency.
										</p>
										<ul>
											<li>
												<p>
                                                    Instead of the client lagging, the host was faster.
												</p>
											</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    {44:00 -&gt; 57:10}
				</p>
				<ul>
					<li>
						<p>
                            Uses a latency diagram to illustrate 'opponent finishing move'.
						</p>
					</li>
					<li>
						<p>
                            To fix, an interpolation of the attacker‚Äôs position during the start of the finishing animation was done, positioning both attacker and target better to play the animation correctly.
						</p>
						<ul>
							<li>
								<p>
                                    &quot;This is not noticeable for the attacker, since the animation start moves the camera so quickly.&quot;
								</p>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    {Rest of video}
				</p>
				<ul>
					<li>
						<p>
                            Interesting discussion on profiling, recording demos, and tools to gather data before optimizing.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    A 'network prioritization' system is made for each object and entity on screen, dynamically varying depending on how perceptible and relevant the object is, optimizing bandwidth usage and not spending resources on imperceptible things.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h3
	id="reconciliation" >
    Reconciliation
</h3>
<ul>
	<li>
		<p>
			<em>
                How errors are handled
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    Smoothly adjusts the player‚Äôs state.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Can cause rubberbanding and small teleports.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Uses
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    World of Warcraft.
				</p>
				<ul>
					<li>
						<p>
                            In 
							<em>
                                World of Warcraft
							</em>
                            , pressing &quot;W&quot; makes your character 
							<strong>
                                start moving immediately
							</strong>
                            &nbsp;(Prediction), and the server confirms later. Other players see your interpolated position to avoid visual teleporting.
						</p>
					</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://github.com/foxssake/netfox" 
				class="external-link" 
				target="_blank" >
                Netfox
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    'Lag compensation with Client-side Prediction and Server-side Reconciliation'.
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://foxssake.github.io/netfox/" 
						class="external-link" 
						target="_blank" >
                        Docs
					</a>
                    .
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://www.youtube.com/watch?v=GqHTNmRspjU" 
						class="external-link" 
						target="_blank" >
                        Explanation
					</a>
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
        <img src="assets/netcode-reconciliation.svg" width="900" >

	</li>
</ul>
<h3
	id="rollback" >
    Rollback
</h3>
<ul>
	<li>
		<p>
			<strong>
                Rollback vs Reconciliation
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Reconciliation:
				</p>
				<ul>
					<li>
						<p>
                            &quot;Rewinds&quot; the local game state to the last server-confirmed state and replays buffered inputs to stay in sync.
						</p>
					</li>
					<li>
						<p>
                            Primarily used for your own client's actions (e.g., moving your character).
						</p>
					</li>
					<li>
						<p>
                            Doesn‚Äôt usually handle interactions with other players/world objects beyond basic corrections.
						</p>
					</li>
					<li>
						<p>
                            In an FPS, your client shows you moving forward instantly, but if the server says you were blocked by a wall, you‚Äôre &quot;snapped back&quot; to the correct position.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Rollback:
				</p>
				<ul>
					<li>
						<p>
                            A more generalized technique where all players' inputs are predicted and rolled back if mispredicted.
						</p>
					</li>
					<li>
						<p>
                            Requires deterministic logic and often peer-to-peer input exchange.
						</p>
					</li>
					<li>
						<p>
                            In a fighting game, if Player A‚Äôs punch was supposed to hit at frame 42 but Player B‚Äôs block input arrived late, the game rolls back to frame 42 and re-simulates with the correct inputs.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Both techniques involve rewinding and replaying to fix mispredictions.
				</p>
			</li>
			<li>
				<p>
                    Client-side reconciliation is a limited form of rollback‚Äîit only handles the local player's state.
				</p>
			</li>
			<li>
				<p>
                    Full rollback systems (like GGPO) apply the concept globally to all entities.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
            Also known as 
			<em>
                Deterministic Lockstep with Rollback
			</em>
            .
		</p>
	</li>
	<li>
		<p>
            Deals more with Inputs than events, like Lockstep, requiring a deterministic game.
		</p>
	</li>
	<li>
		<p>
			<em>
                Use without Prediction
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    The game waits to receive inputs from all players before processing the next frame.
				</p>
			</li>
			<li>
				<p>
                    If an input arrives late, the game needs to &quot;rewind&quot; (rollback), recalculate affected frames, and update the state.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<em>
                Use with Prediction
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    While waiting for the opponent‚Äôs real inputs, the client 
					<strong>
                        predicts
					</strong>
                    &nbsp;what will probably happen and displays it on screen.
				</p>
			</li>
			<li>
				<p>
                    If the prediction is wrong, rollback occurs to correct the state.
				</p>
			</li>
			<li>
				<p>
                    &quot;Goes back in time and re-applies inputs in case of errors.&quot;
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<em>
                How errors are handled
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    Rewinds the game and reapplies inputs.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Requirements
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    <img src="assets/image_20250131195955.png" width="375" >
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Uses
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    <img src="assets/image_20250131200140.png" width="375" >
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Advantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    <img src="assets/image_20250131200318.png" width="375" >
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Can cause visual glitches if too much rollback occurs.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=zvqQPbT8rAE&list=PLCBLMvLIundBXwTa6gwlOUNc29_9btoir" 
				class="external-link" 
				target="_blank" >
                Rollback Netcode in Godot {Playlist with 11 videos}
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
					<a
						href="https://gitlab.com/snopek-games/godot-rollback-netcode/" 
						class="external-link" 
						target="_blank" >
                        Godot Rollback Netcode
					</a>
                    .
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://gitlab.com/BimDav/delta-rollback/" 
						class="external-link" 
						target="_blank" >
                        Delta Rollback
					</a>
                    .
				</p>
				<ul>
					<li>
						<p>
                            Fork of the addon above.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    The videos are very well produced.
				</p>
			</li>
			<li>
				<p>
                    Uses Godot 3, unfortunately.
				</p>
			</li>
			<li>
				<p>
                    The game made is a peer-to-peer, Client-Authority game.
				</p>
			</li>
			<li>
				<p>
                    The system is based on completely restructuring the existing system, using several special virtual functions and a state and input storage system.
				</p>
			</li>
			<li>
				<p>
                    Video 1 already explains the basic setup.
				</p>
			</li>
			<li>
				<p>
                    I watched only videos 1 and 2.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=7jb0FOcImdg" 
				class="external-link" 
				target="_blank" >
                Using Rollback instead of Lockstep
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    Watched up to 25:00.
				</p>
			</li>
			<li>
				<p>
                    A super technical and interesting video.
				</p>
			</li>
			<li>
				<p>
                    The Rollback system was implemented to synchronize between peers, so that frames lost due to latency are quickly simulated in the same frame to ensure smoothness.
				</p>
			</li>
			<li>
				<p>
                    Uses a P2P connection, where only input information is sent between the Client-server (peer host) and the Client (another peer).
				</p>
			</li>
		</ul>
	</li>
</ul>

				</article>
			</main>
			<footer
				id="central-footer" >
                üßë‚Äçüíª built and copyrighted by
				<a
					href="https://github.com/caioraphael1" 
					target="_blank" >
                    Caio Raphael
				</a>
                üìÖ 2025-2026 üöÄ
			</footer>
		</main>
		<script
			src="/static/studies.39984.js" >
		</script>
	</body>
</html>
