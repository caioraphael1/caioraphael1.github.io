<!doctype html>
<html
	lang="en" >
	<head>
		<title>
            Caio Raphael
		</title>
		<meta
			charset="utf-8" >
		<meta
			name="viewport" 
			content="width=device-width, initial-scale=1" >
		<meta
			name="description" 
			content="Senior Game Developer, Engine Developer, Low-Level Network, Low-Level Systems" >
		<meta
			name="author" 
			content="Caio Raphael" >
		<meta
			name="theme-color" 
			content="#ffffff" 
			media="(prefers-color-scheme: light)" >
		<meta
			name="theme-color" 
			content="#101010" 
			media="(prefers-color-scheme: dark)" >
		<link
			rel="icon" 
			href="/assets/favicon.ico" >
		<link
			rel="icon" 
			href="/assets/favicon-16x16.png" 
			sizes="16x16" 
			type="image/png" >
		<link
			rel="icon" 
			href="/assets/favicon-32x32.png" 
			sizes="32x32" 
			type="image/png" >
		<script
			src="/static/docs_load.js" >
		</script>
		<script>
window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    displayMath: [['$$', '$$']]
                }
                };
		</script>
		<script
			src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" >
		</script>
		<script
			src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js" >
		</script>
		<script
			src="https://unpkg.com/highlightjs-odinlang@1.4.0/dist/odin.min.js" >
		</script>
		<script
			type="module" >

                    import hljs from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/highlight.min.js';
                    import hljs_odin from 'https://unpkg.com/highlightjs-odinlang@1.4.0/dist/odin.es.min.js';
                    hljs.registerLanguage('odin', hljs_odin);
                    hljs.highlightAll();
                
		</script>
		<link
			rel="stylesheet" 
			href="/static/docs.css" >
	</head>
	<body>
		<aside
			id="left-sidebar" >
			<a
				href="/" 
				class="site-logo" >
                Caio Raphael
			</a>
			<nav>
				<details
>
					<summary>
                        Graphics Programming
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/Vulkan/Vulkan.html" >
                                Vulkan
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/Render Engineering/Render Engineering.html" >
                                Render Engineering
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/Graphics and Shaders/Graphics and Shaders.html" >
                                Graphics and Shaders
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/GLSL/GLSL.html" >
                                GLSL
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/GPU/GPU.html" >
                                GPU
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/OpenGL/OpenGL.html" >
                                OpenGL
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Graphics Programming/Slang.html" >
                                Slang
							</a>
						</li>
					</ul>
				</details>
				<details
>
					<summary>
                        Design
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - DOD e COP/Design - DOD e COP.html" >
                                Design - DOD e COP
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - ECS/Design - ECS.html" >
                                Design - ECS
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - Design Patterns/Design - Design Patterns.html" >
                                Design - Design Patterns
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - Architecture Patterns.html" >
                                Design - Architecture Patterns
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - Concepts and Terminology.html" >
                                Design - Concepts and Terminology
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - Rules of thumb - Laws - Guidelines and Principles/Design - Rules of thumb - Laws - Guidelines and Principles.html" >
                                Design - Rules of thumb - Laws - Guidelines and Principles
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - Paradigms.html" >
                                Design - Paradigms
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Design/Design - Production Methodologies/Design - Production Methodologies.html" >
                                Design - Production Methodologies
							</a>
						</li>
					</ul>
				</details>
				<details
					open="">
					<summary>
                        Network
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Network/Network - Backend/Network - Backend.html" >
                                Network - Backend
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Network/Network - Low Level e Etc/Network - Low Level e Etc.html" >
                                Network - Low Level e Etc
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="active" 
								href="/docs/Network/Network - Netcode/Network - Netcode.html" >
                                Network - Netcode
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Network/Network - HTTP/Network - HTTP.html" >
                                Network - HTTP
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Network/Encryption.html" >
                                Encryption
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Network/SSH.html" >
                                SSH
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Network/Serialization - Encoding/Serialization - Encoding.html" >
                                Serialization - Encoding
							</a>
						</li>
					</ul>
				</details>
				<details
>
					<summary>
                        Things
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Build Systems - Compilation - Linking/Build Systems - Compilation - Linking.html" >
                                Build Systems - Compilation - Linking
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/CPU/CPU.html" >
                                CPU
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Code Editors/NeoVim - Setup/NeoVim - Setup.html" >
                                NeoVim - Setup
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Code Editors/NeoVim - Uso/NeoVim - Uso.html" >
                                NeoVim - Uso
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Code Editors/VSCode - VSCodium.html" >
                                VSCode - VSCodium
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Code Editors/Visual Studio/Visual Studio.html" >
                                Visual Studio
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Debuggers.html" >
                                Debuggers
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Dependencies.html" >
                                Dependencies
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Git/Git.html" >
                                Git
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Handmade Hero/Handmade Hero.html" >
                                Handmade Hero
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Linux/Linux.html" >
                                Linux
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Memory/Memory.html" >
                                Memory
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Multithreading/Multithreading.html" >
                                Multithreading
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/RegEx.html" >
                                RegEx
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Shells/Shells.html" >
                                Shells
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Things/Terminal/Terminal.html" >
                                Terminal
							</a>
						</li>
					</ul>
				</details>
				<details
>
					<summary>
                        Programming Languages
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Assembly - ASM.html" >
                                Assembly - ASM
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/C++/C++.html" >
                                C++
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/C.html" >
                                C
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/CSharp/CSharp.html" >
                                CSharp
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Go.html" >
                                Go
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Haxe.html" >
                                Haxe
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/JAI.html" >
                                JAI
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Java.html" >
                                Java
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Kotlin.html" >
                                Kotlin
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Lua.html" >
                                Lua
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Nim/Nim.html" >
                                Nim
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Odin/Odin.html" >
                                Odin
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Python.html" >
                                Python
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Rust/Rust.html" >
                                Rust
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Swift/Swift.html" >
                                Swift
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Programming Languages/Zig/Zig.html" >
                                Zig
							</a>
						</li>
					</ul>
				</details>
				<details
>
					<summary>
                        WebDev
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/WebDev/WebDev.html" >
                                WebDev
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/HTML/HTML.html" >
                                HTML
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/HTMX.html" >
                                HTMX
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/WebAssembly - WASM/WebAssembly - WASM.html" >
                                WebAssembly - WASM
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/CSS/CSS.html" >
                                CSS
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/JavaScript/JavaScript.html" >
                                JavaScript
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/TypeScript.html" >
                                TypeScript
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/JavaScript - Frameworks and Libraries/JavaScript - Frameworks and Libraries.html" >
                                JavaScript - Frameworks and Libraries
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/JavaScript - Runtime Environments.html" >
                                JavaScript - Runtime Environments
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/Hugo/Hugo.html" >
                                Hugo
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/Static Site Generators.html" >
                                Static Site Generators
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/WebDev/HTML - Tests/HTML - Tests.html" >
                                HTML - Tests
							</a>
						</li>
					</ul>
				</details>
				<details
>
					<summary>
                        Databases
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Databases/Databases - MongoDB.html" >
                                Databases - MongoDB
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Databases/Databases - SQL - Relational/Databases - SQL - Relational.html" >
                                Databases - SQL - Relational
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Databases/Databases - Document Oriented.html" >
                                Databases - Document Oriented
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Databases/Databases - Object Oriented.html" >
                                Databases - Object Oriented
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Databases/Databases - ORMs.html" >
                                Databases - ORMs
							</a>
						</li>
					</ul>
				</details>
				<details
>
					<summary>
                        Electronics
					</summary>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Electronics/Electronics - Sources and Studies.html" >
                                Electronics - Sources and Studies
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Electronics/Electronics - Projects and Tutorials.html" >
                                Electronics - Projects and Tutorials
							</a>
						</li>
					</ul>
					<ul>
						<li>
							<a
								class="" 
								href="/docs/Electronics/Arduino.html" >
                                Arduino
							</a>
						</li>
					</ul>
				</details>
			</nav>
		</aside>
		<div
			id="central-wrapper" >
			<header
				id="central-header" >
				<nav
					id="dropdown-menu" >
					<select
						onchange="if (this.value) window.location.href=this.value" >
						<option
							value="/" 
>
                            🏡 Home
						</option>
						<option
							value="/docs/_index.html" 
							selected="">
                            📖 Docs
						</option>
					</select>
				</nav>
				<button
					class="btn" 
					id="button-color-theme" >
					<i>
                        ☀️ / 🌑
					</i>
				</button>
			</header>
			<main>
				<article
					id="note-article" >
					<header>
						<h1>
                            Network - Netcode
						</h1>
						<p>
							<time
								datetime="2024-10-19" >
                                🕒 Created: 2024-10-19
							</time>
							<time
								datetime="2025-10-29" >
                                | Updated: 2025-10-29
							</time>
						</p>
					</header>
					<div
						id="note-content" >
<h3
	id="about" >
    About
</h3>
<ul>
	<li>
		<p>
            &quot;A set of specific techniques and algorithms that make network communication work in a multiplayer game. This includes how data packets are sent and received, how network latency is handled, and how the game deals with packet loss, interpolation, extrapolation, etc.&quot;
		</p>
	</li>
</ul>
<h3
	id="synchronization" >
    Synchronization
</h3>
<h5
	id="clock-sync" >
    Clock Sync
</h5>
<ul>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=TwVT3Qx9xEM" 
				class="external-link" 
				target="_blank" >
                Implementation
			</a>
            .
		</p>
	</li>
</ul>
<h2
	id="full-synchronization-with-input-lag" >
    Full Synchronization with Input Lag
</h2>
<h5
	id="lockstep" >
    Lockstep
</h5>
<ul>
	<li>
		<p>
            &quot;The inputs of both players are exchanged with each other, so both players will be running the same simulation.&quot;
		</p>
	</li>
	<li>
		<p>
            A stricter synchronization method where all machines involved in the system must process the same inputs at the same time before advancing.
		</p>
	</li>
	<li>
		<p>
			<strong>
                Requirements
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    The game must be absolutely 
					<strong>
                        deterministic
					</strong>
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Advantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Keeps all players perfectly synchronized.
				</p>
			</li>
			<li>
				<p>
                    Prevents cheating that could occur in client-authoritative netcodes.
				</p>
			</li>
			<li>
				<p>
                    Uses low bandwidth, as only inputs are sent.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Can be affected by 
					<strong>
                        input lag
					</strong>
                    , since all players must wait for each other's inputs before advancing.
				</p>
			</li>
			<li>
				<p>
                    If one player has high latency, all others are impacted (the classic &quot;slowdown&quot; problem in old RTS games).
				</p>
			</li>
			<li>
				<p>
                    Harder to scale for games with many simultaneous players.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Uses
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    RTS (Real-Time Strategy):
				</p>
				<ul>
					<li>
						<p>
                            StarCraft, Age of Empires
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    TBS (Turn-Based Strategy):
				</p>
				<ul>
					<li>
						<p>
                            XCOM Multiplayer, Civilization
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Physics-Based Deterministic Games:
				</p>
				<ul>
					<li>
						<p>
                            Games that require identical simulations on all machines.
						</p>
					</li>
				</ul>
			</li>
		</ul>
	</li>
</ul>
<h2
	id="lag-compensation" >
    Lag Compensation
</h2>
<h3
	id="interpolation" >
    Interpolation
</h3>
<ul>
	<li>
		<p
			class="line-emphasis" >
            Useful for 
			<strong>
                other players
			</strong>
            .
		</p>
	</li>
	<li>
		<p>
            Uses past states to create smooth transitions between positions.
		</p>
	</li>
	<li>
		<p>
            Renders the world 50~100ms in the 
			<strong>
                past
			</strong>
            , to know where the player is and where they will be, interpolating the position between these two points, considering the distance traveled and the time spent.
		</p>
	</li>
	<li>
		<p>
			<strong>
                Advantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Smooth movements without sudden jumps.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Introduces 
					<strong>
                        input lag
					</strong>
                    &nbsp;indirectly, by rendering the world in the past.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Use
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    MOBAs and games where a small delay does not affect gameplay.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Impressions
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Games relying on mouse clicks can work, but for more tactile inputs like keyboard movement, input lag becomes very noticeable.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=w2p0ugw3afs" 
				class="external-link" 
				target="_blank" >
                Implementing Interpolation
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    The person uses a 20Hz server.
				</p>
			</li>
		</ul>
	</li>
	<li>
        <img src="assets/network_-_interpolation.excalidraw" width="" alt="<excalidraw_not_loaded>" >

	</li>
</ul>
<h3
	id="strategies-for-dealing-with-rubberbanding" >
    Strategies for Dealing with Rubberbanding
</h3>
<ul>
	<li>
		<p>
			<strong>
                Smooth and Gradual Corrections
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Instead of instantly moving the player to the corrected position, the server sends the correction gradually, over a few milliseconds (LERP, Linear Interpolation).
				</p>
			</li>
			<li>
				<p>
                    If the server detects that the player’s position was incorrect due to prediction, it moves the player smoothly to the correct position over 100-200ms. Transition time depends on the prediction error magnitude.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Speed Adjustment
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    When the player’s position is incorrect, adjust their 
					<strong>
                        speed
					</strong>
                    &nbsp;or 
					<strong>
                        movement
					</strong>
                    &nbsp;to correct the discrepancy instead of repositioning them immediately.
				</p>
			</li>
			<li>
				<p>
                    If a player predicted a wrong movement, instead of &quot;jumping&quot; to the correct position, they can move slowly until they reach the correct spot.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Correction Size Limitation
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    The server can set 
					<strong>
                        limits
					</strong>
                    &nbsp;for allowed corrections. If the difference between predicted and correct positions is too large, the correction is done more cautiously, or temporarily ignored until the player &quot;approaches&quot; the correct point.
				</p>
			</li>
			<li>
				<p>
                    If the prediction error is 10 meters, the server might allow only a 3-meter correction at a time instead of teleporting the player all at once.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                &quot;Less Frequent State Correction&quot; System
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    The server can correct the player’s state 
					<strong>
                        less frequently
					</strong>
                    &nbsp;or only when the error is significant. This can include a strategy to correct the state 
					<strong>
                        periodically
					</strong>
                    &nbsp;(e.g., every 200ms or 500ms) without trying to correct all prediction errors at once.
				</p>
			</li>
			<li>
				<p>
                    The server checks and corrects the player’s position only every second, or every 200ms, depending on the perceived error.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h3
	id="prediction" >
    Prediction
</h3>
<ul>
	<li>
		<p>
			<strong>
                My interpretation
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    For the player:
				</p>
				<ul>
					<li>
						<p>
                            &quot;The client goes ahead by processing the input locally.&quot;
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    For other players:
				</p>
				<ul>
					<li>
						<p>
                            &quot;The client assumes that the other player will maintain the same direction and/or input.&quot;
						</p>
					</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>
		<p>
            Prediction of 
			<strong>
                local input
			</strong>
            &nbsp;results before server confirmation.
		</p>
	</li>
	<li>
		<p>
			<strong>
                When to use
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    A way to reduce input lag.
				</p>
			</li>
			<li>
				<p>
                    When a player performs an action, and the game needs to display it immediately without waiting for the server.
				</p>
			</li>
			<li>
				<p>
                    Example:
				</p>
				<ul>
					<li>
						<p>
                            You press a key to move → the character moves 
							<strong>
                                immediately
							</strong>
                            &nbsp;on your PC without waiting for the server.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p
					class="line-emphasis" >
                    The client displays slightly past states to smooth the movement of 
					<strong>
                        other
					</strong>
                    &nbsp;players.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Advantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    More fluid and responsive gameplay.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    If the server disagrees, it can cause sudden corrections (rubberbanding).
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Use
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    FPS, MOBAs, any game requiring fast response.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h3
	id="extrapolation" >
    Extrapolation
</h3>
<ul>
	<li>
		<p>
            Prediction of 
			<strong>
                other players/objects
			</strong>
            &nbsp;positions when the server does not send new packets.
		</p>
	</li>
	<li>
		<p>
            &quot;Sometimes during interpolation, the future frame is not stored due to high lag or packet loss, etc. In this case, Interpolation no longer works.&quot;
		</p>
	</li>
	<li>
		<p>
			<strong>
                When to use
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    A form of lag compensation.
				</p>
			</li>
			<li>
				<p>
                    When there is packet loss or high latency, and the game needs to &quot;guess&quot; where a player is.
				</p>
			</li>
			<li>
				<p>
                    Example:
				</p>
				<ul>
					<li>
						<p>
                            The game doesn’t receive the next packet about an enemy’s position → assumes they continue in the same direction until new information arrives.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p
					class="line-emphasis" >
                    If packets are delayed, the game estimates the future position of 
					<strong>
                        other
					</strong>
                    &nbsp;players.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Advantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Prevents freezing or delayed movement display.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    If a player does something unexpected, it can cause jumps or sudden corrections.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Use
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Racing games, sports games, where movement is predictable.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=XGyrKmOxLcc" 
				class="external-link" 
				target="_blank" >
                Implementing Extrapolation
			</a>
            .
		</p>
	</li>
</ul>
<h2
	id="correcting-wrong-states-or-predictions" >
    Correcting Wrong States (or Predictions)
</h2>
<ul>
	<li>
		<p>
            Techniques used together with Prediction.
		</p>
	</li>
</ul>
<h3
	id="replication" >
    Replication
</h3>
<ul>
	<li>
		<p>
            Replicates 
			<strong>
                data
			</strong>
            &nbsp;and 
			<strong>
                events
			</strong>
            &nbsp;occurring on the Host / Server.
		</p>
	</li>
	<li>
		<p>
            This strategy makes more sense for P2P architectures, since a dedicated server does not necessarily have information to &quot;replicate.&quot;
		</p>
	</li>
	<li>
		<p>
            I understand Replication and Reconciliation as similar in philosophy, but Reconciliation uses a Prediction model, while Replication uses replication of host P2P states and events to later resynchronize.
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://youtu.be/h47zZrqjgLc?si=b5WgE0kjyko2fYZZ&t=1599" 
				class="external-link" 
				target="_blank" >
                P2P and Netcode in Halo Reach
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    {26:39 -&gt; 35:00}
				</p>
				<ul>
					<li>
						<p>
                            Uses a latency diagram to illustrate 'grenade throwing'.
						</p>
					</li>
					<li>
						<p>
                            {32:17} Solution.
						</p>
						<ul>
							<li>
								<p>
                                    &quot;Never have input lag; if the player presses a button, they get frustrated if no immediate action happens on screen.&quot;
								</p>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    {35:00 -&gt; 44:00}
				</p>
				<ul>
					<li>
						<p>
                            Uses a latency diagram to illustrate 'Armor Lock'.
						</p>
					</li>
					<li>
						<p>
                            {41:20} Solution.
						</p>
						<ul>
							<li>
								<p>
                                    To fix, &quot;lag debt&quot; was paid on the host, so the host activated the shield earlier than it should, giving the requesting client feedback that things are happening in real-time.
								</p>
								<ul>
									<li>
										<p>
                                            This is interesting because it modifies mechanics on the host to cancel the perception of latency.
										</p>
										<ul>
											<li>
												<p>
                                                    Instead of the client lagging, the host was faster.
												</p>
											</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    {44:00 -&gt; 57:10}
				</p>
				<ul>
					<li>
						<p>
                            Uses a latency diagram to illustrate 'opponent finishing move'.
						</p>
					</li>
					<li>
						<p>
                            To fix, an interpolation of the attacker’s position during the start of the finishing animation was done, positioning both attacker and target better to play the animation correctly.
						</p>
						<ul>
							<li>
								<p>
                                    &quot;This is not noticeable for the attacker, since the animation start moves the camera so quickly.&quot;
								</p>
							</li>
						</ul>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    {Rest of video}
				</p>
				<ul>
					<li>
						<p>
                            Interesting discussion on profiling, recording demos, and tools to gather data before optimizing.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    A 'network prioritization' system is made for each object and entity on screen, dynamically varying depending on how perceptible and relevant the object is, optimizing bandwidth usage and not spending resources on imperceptible things.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h3
	id="reconciliation" >
    Reconciliation
</h3>
<ul>
	<li>
		<p>
			<em>
                How errors are handled
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    Smoothly adjusts the player’s state.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Can cause rubberbanding and small teleports.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Uses
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    World of Warcraft.
				</p>
				<ul>
					<li>
						<p>
                            In 
							<em>
                                World of Warcraft
							</em>
                            , pressing &quot;W&quot; makes your character 
							<strong>
                                start moving immediately
							</strong>
                            &nbsp;(Prediction), and the server confirms later. Other players see your interpolated position to avoid visual teleporting.
						</p>
					</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://github.com/foxssake/netfox" 
				class="external-link" 
				target="_blank" >
                Netfox
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    'Lag compensation with Client-side Prediction and Server-side Reconciliation'.
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://foxssake.github.io/netfox/" 
						class="external-link" 
						target="_blank" >
                        Docs
					</a>
                    .
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://www.youtube.com/watch?v=GqHTNmRspjU" 
						class="external-link" 
						target="_blank" >
                        Explanation
					</a>
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
        <img src="assets/Reconciliation.excalidraw" width="451" alt="<excalidraw_not_loaded>" >

	</li>
</ul>
<h3
	id="rollback" >
    Rollback
</h3>
<ul>
	<li>
		<p>
			<strong>
                Rollback vs Reconciliation
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Reconciliation:
				</p>
				<ul>
					<li>
						<p>
                            &quot;Rewinds&quot; the local game state to the last server-confirmed state and replays buffered inputs to stay in sync.
						</p>
					</li>
					<li>
						<p>
                            Primarily used for your own client's actions (e.g., moving your character).
						</p>
					</li>
					<li>
						<p>
                            Doesn’t usually handle interactions with other players/world objects beyond basic corrections.
						</p>
					</li>
					<li>
						<p>
                            In an FPS, your client shows you moving forward instantly, but if the server says you were blocked by a wall, you’re &quot;snapped back&quot; to the correct position.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Rollback:
				</p>
				<ul>
					<li>
						<p>
                            A more generalized technique where all players' inputs are predicted and rolled back if mispredicted.
						</p>
					</li>
					<li>
						<p>
                            Requires deterministic logic and often peer-to-peer input exchange.
						</p>
					</li>
					<li>
						<p>
                            In a fighting game, if Player A’s punch was supposed to hit at frame 42 but Player B’s block input arrived late, the game rolls back to frame 42 and re-simulates with the correct inputs.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Both techniques involve rewinding and replaying to fix mispredictions.
				</p>
			</li>
			<li>
				<p>
                    Client-side reconciliation is a limited form of rollback—it only handles the local player's state.
				</p>
			</li>
			<li>
				<p>
                    Full rollback systems (like GGPO) apply the concept globally to all entities.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
            Also known as 
			<em>
                Deterministic Lockstep with Rollback
			</em>
            .
		</p>
	</li>
	<li>
		<p>
            Deals more with Inputs than events, like Lockstep, requiring a deterministic game.
		</p>
	</li>
	<li>
		<p>
			<em>
                Use without Prediction
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    The game waits to receive inputs from all players before processing the next frame.
				</p>
			</li>
			<li>
				<p>
                    If an input arrives late, the game needs to &quot;rewind&quot; (rollback), recalculate affected frames, and update the state.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<em>
                Use with Prediction
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    While waiting for the opponent’s real inputs, the client 
					<strong>
                        predicts
					</strong>
                    &nbsp;what will probably happen and displays it on screen.
				</p>
			</li>
			<li>
				<p>
                    If the prediction is wrong, rollback occurs to correct the state.
				</p>
			</li>
			<li>
				<p>
                    &quot;Goes back in time and re-applies inputs in case of errors.&quot;
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<em>
                How errors are handled
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    Rewinds the game and reapplies inputs.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Requirements
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    <img src="assets/image_20250131195955.png" width="375" >
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Uses
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    <img src="assets/image_20250131200140.png" width="375" >
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Advantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    <img src="assets/image_20250131200318.png" width="375" >
                    .
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Disadvantages
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Can cause visual glitches if too much rollback occurs.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=zvqQPbT8rAE&list=PLCBLMvLIundBXwTa6gwlOUNc29_9btoir" 
				class="external-link" 
				target="_blank" >
                Rollback Netcode in Godot {Playlist with 11 videos}
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
					<a
						href="https://gitlab.com/snopek-games/godot-rollback-netcode/" 
						class="external-link" 
						target="_blank" >
                        Godot Rollback Netcode
					</a>
                    .
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://gitlab.com/BimDav/delta-rollback/" 
						class="external-link" 
						target="_blank" >
                        Delta Rollback
					</a>
                    .
				</p>
				<ul>
					<li>
						<p>
                            Fork of the addon above.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    The videos are very well produced.
				</p>
			</li>
			<li>
				<p>
                    Uses Godot 3, unfortunately.
				</p>
			</li>
			<li>
				<p>
                    The game made is a peer-to-peer, Client-Authority game.
				</p>
			</li>
			<li>
				<p>
                    The system is based on completely restructuring the existing system, using several special virtual functions and a state and input storage system.
				</p>
			</li>
			<li>
				<p>
                    Video 1 already explains the basic setup.
				</p>
			</li>
			<li>
				<p>
                    I watched only videos 1 and 2.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=7jb0FOcImdg" 
				class="external-link" 
				target="_blank" >
                Using Rollback instead of Lockstep
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    Watched up to 25:00.
				</p>
			</li>
			<li>
				<p>
                    A super technical and interesting video.
				</p>
			</li>
			<li>
				<p>
                    The Rollback system was implemented to synchronize between peers, so that frames lost due to latency are quickly simulated in the same frame to ensure smoothness.
				</p>
			</li>
			<li>
				<p>
                    Uses a P2P connection, where only input information is sent between the Client-server (peer host) and the Client (another peer).
				</p>
			</li>
		</ul>
	</li>
</ul>

					</div>
					<footer
						id="previous-next" >
						<a
							href="/docs/Network/Network - Low Level e Etc/Network - Low Level e Etc.html" >
                            &nbsp;&lsaquo; Previous
						</a>
						<a
							href="/docs/Network/Network - HTTP/Network - HTTP.html" >
                            Next &rsaquo; 
						</a>
					</footer>
				</article>
			</main>
			<footer
				id="central-footer" >
                🧑‍💻 built by and copyright
				<a
					href="https://github.com/caioraphael1" 
					target="_blank" >
                    Caio Raphael
				</a>
                📅 2025-10-21 .&nbsp;&nbsp;2025-10-30 🚀
			</footer>
		</div>
		<aside
			id="right-sidebar" >
			<nav
				id="table-of-contents" >
				<strong>
                    On this page
				</strong>
				<ul>
					<ul>
						<li>
							<a
								href="#about" >
                                About
							</a>
						</li>
						<li>
							<a
								href="#synchronization" >
                                Synchronization
							</a>
						</li>
					</ul>
					<li>
						<a
							href="#full-synchronization-with-input-lag" >
                            Full Synchronization with Input Lag
						</a>
						<ul>
						</ul>
					</li>
					<li>
						<a
							href="#lag-compensation" >
                            Lag Compensation
						</a>
						<ul>
							<li>
								<a
									href="#interpolation" >
                                    Interpolation
								</a>
							</li>
							<li>
								<a
									href="#strategies-for-dealing-with-rubberbanding" >
                                    Strategies for Dealing with Rubberbanding
								</a>
							</li>
							<li>
								<a
									href="#prediction" >
                                    Prediction
								</a>
							</li>
							<li>
								<a
									href="#extrapolation" >
                                    Extrapolation
								</a>
							</li>
						</ul>
					</li>
					<li>
						<a
							href="#correcting-wrong-states-or-predictions" >
                            Correcting Wrong States (or Predictions)
						</a>
						<ul>
							<li>
								<a
									href="#replication" >
                                    Replication
								</a>
							</li>
							<li>
								<a
									href="#reconciliation" >
                                    Reconciliation
								</a>
							</li>
							<li>
								<a
									href="#rollback" >
                                    Rollback
								</a>
							</li>
						</ul>
					</li>
				</ul>
			</nav>
		</aside>
		<script
			src="/static/docs.js" >
		</script>
	</body>
</html>
