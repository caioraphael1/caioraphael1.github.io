<!doctype html>
<html
	lang="en" >
	<head>
		<title>
            Caio Raphael
		</title>
		<meta
			charset="utf-8" >
		<meta
			name="viewport" 
			content="width=device-width, initial-scale=1" >
		<meta
			name="description" 
			content="Senior Game Developer, Engine Developer, Low-Level Network, Low-Level Systems" >
		<meta
			name="author" 
			content="Caio Raphael" >
		<meta
			name="theme-color" 
			content="#ffffff" 
			media="(prefers-color-scheme: light)" >
		<meta
			name="theme-color" 
			content="#101010" 
			media="(prefers-color-scheme: dark)" >
		<link
			rel="icon" 
			href="/assets/icon.ico" >
		<link
			rel="icon" 
			href="/assets/icon-16x16.png" 
			sizes="16x16" 
			type="image/png" >
		<link
			rel="icon" 
			href="/assets/icon-32x32.png" 
			sizes="32x32" 
			type="image/png" >
		<script>
window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    displayMath: [['$$', '$$']]
                }
                };
		</script>
		<script
			src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" >
		</script>
		<script
			type="module" >

                    import hljs from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/highlight.min.js';
                    import hljs_odin from 'https://unpkg.com/highlightjs-odinlang@1.4.0/dist/odin.es.min.js';
                    import hljs_glsl from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/languages/glsl.min.js';
                    import hljs_swift  from 'https://unpkg.com/@highlightjs/cdn-assets@11.11.1/es/languages/swift.min.js';
                    hljs.registerLanguage('odin', hljs_odin);
                    hljs.registerLanguage('glsl', hljs_glsl);
                    hljs.registerLanguage('gdscript', hljs_swift);
                    hljs.highlightAll();
                
		</script>
		<link
			rel="stylesheet" 
			href="/static/studies.30472.css" >
	</head>
	<body>
		<aside
			id="left-sidebar-wrapper" >
			<div
				id="left-sidebar" >
				<header>
					<a
						href="/" 
						class="site-logo" >
                        Caio Raphael
					</a>
					<p
						class="breadcrums-division" >
                        /
					</p>
					<a
						href="/studies/_index.html" 
						class="breadcrumbs-studies" >
                        Studies
					</a>
				</header>
				<nav>
					<details
						open="">
						<summary>
                            Vulkan
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-basic.html" >
                                    Basic
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-samples.html" >
                                    Samples
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-core.html" >
                                    Core
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-render-loop.html" >
                                    Render Loop
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-synchronization-and-cache-control.html" >
                                    Synchronization and Cache Control
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-command-buffers.html" >
                                    Command Buffers
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-pipelines.html" >
                                    Pipelines
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-graphics-pipeline.html" >
                                    Graphics Pipeline
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-compute-pipeline.html" >
                                    Compute Pipeline
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-resources.html" >
                                    Resources
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="active" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-depth.html" >
                                    Depth
								</a>
								<ul>
									<li>
										<a
											href="#depth-tests" >
                                            Depth Tests
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#depth-attachment" >
                                            Depth Attachment
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#depth-image" >
                                            Depth Image
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#normal-reconstruction-from-depth" >
                                            Normal Reconstruction from Depth
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#stencil" >
                                            Stencil
										</a>
										<ul>
										</ul>
									</li>
									<li>
										<a
											href="#stencil-attachment" >
                                            Stencil Attachment
										</a>
										<ul>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-mapping-data-to-shaders.html" >
                                    Mapping Data to Shaders
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-memory-allocation.html" >
                                    Memory Allocation
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-hdr-support.html" >
                                    HDR Support
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-profiling.html" >
                                    Profiling
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-mobile.html" >
                                    Mobile
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-vr.html" >
                                    VR
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-video-decoding.html" >
                                    Video Decoding
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-spir-v.html" >
                                    SPIR-V
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Vulkan/Vulkan-web.html" >
                                    Web
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Render Engineering
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-graphics-apis.html" >
                                    Graphics APIs
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-shader-languages.html" >
                                    Shader Languages
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-tools.html" >
                                    Tools
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-choosing-the-space-to-compute-lighting.html" >
                                    Choosing the Space to compute Lighting
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-bsdf-bidirectional-scattering-distribution-function.html" >
                                    BSDF (Bidirectional Scattering Distribution Function)
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-material.html" >
                                    Material
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-direct-lighting.html" >
                                    Direct Lighting
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-shadows.html" >
                                    Shadows
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-skybox-skydome.html" >
                                    Skybox / Skydome
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-transparency.html" >
                                    Transparency
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-global-illumination-indirect-lighting.html" >
                                    Global Illumination / Indirect Lighting
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-global-illumination-solutions.html" >
                                    Global Illumination - Solutions
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-global-illumination-discarded-solutions.html" >
                                    Global Illumination - Discarded Solutions
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-lightmaps.html" >
                                    Lightmaps
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-post-processing.html" >
                                    Post-Processing
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-anti-aliasing.html" >
                                    Anti-Aliasing
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-light-path-rendering-method.html" >
                                    Light Path / Rendering Method
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Render Engineering/Render Engineering-optimization-techniques.html" >
                                    Optimization Techniques
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Graphics and Shaders
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Graphics and Shaders/Graphics and Shaders-sources.html" >
                                    Sources
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Graphics and Shaders/Graphics and Shaders-math-linear-algebra.html" >
                                    Math, Linear Algebra
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Graphics and Shaders/Graphics and Shaders-spaces-transformations-and-graphics-pipeline.html" >
                                    Spaces, Transformations and Graphics Pipeline
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Graphics and Shaders/Graphics and Shaders-common-techniques.html" >
                                    Common Techniques
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Graphics and Shaders/Graphics and Shaders-shaders.html" >
                                    Shaders
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            GLSL
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GLSL/GLSL-basic.html" >
                                    Basic
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GLSL/GLSL-storage-qualifiers.html" >
                                    Storage Qualifiers
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GLSL/GLSL-layout-qualifiers.html" >
                                    Layout Qualifiers
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            GPU
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GPU/GPU-execution-building-blocks.html" >
                                    Execution Building Blocks
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GPU/GPU-specialized-units-and-instructions.html" >
                                    Specialized units &amp; instructions
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GPU/GPU-memory.html" >
                                    Memory
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GPU/GPU-cache.html" >
                                    Cache
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GPU/GPU-gpu-va-virtual-address.html" >
                                    GPU VA (Virtual Address)
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/GPU/GPU-tiled-gpus.html" >
                                    Tiled-GPUs
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Slang
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Slang-slang.html" >
                                    Slang
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            Font Rendering
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-techniques.html" >
                                    Techniques
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-text-processing-pipeline.html" >
                                    Text Processing Pipeline
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-concepts.html" >
                                    Concepts
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-formats.html" >
                                    Formats
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-libs.html" >
                                    Libs
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-tools.html" >
                                    Tools
								</a>
							</li>
						</ul>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/Font Rendering-fonts.html" >
                                    Fonts
								</a>
							</li>
						</ul>
					</details>
					<details
>
						<summary>
                            OpenGL
						</summary>
						<ul>
							<li>
								<a
									class="" 
									href="/studies/Graphics Programming/OpenGL/OpenGL-about.html" >
                                    About
								</a>
							</li>
						</ul>
					</details>
				</nav>
			</div>
		</aside>
		<main
			id="central-wrapper" >
			<main
				id="note-wrapper" >
				<header
					id="note-header" >
					<h1>
                        Depth
					</h1>
					<p>
						<time
							datetime="2025-08-01" >
                            ðŸ•’ Created: 2025-08-01
						</time>
						<time
							datetime="2026-01-22" >
                            | Updated: 2026-01-22
						</time>
					</p>
				</header>
				<article
					id="note-content" >
<h3
	id="depth-tests" >
    Depth Tests
</h3>
<h5
	id="shader" >
    Shader
</h5>
<ul>
	<li>
		<p>
            <code>gl_FragDepth</code>
		</p>
		<ul>
			<li>
				<p>
                    Available only in the fragment shader.
				</p>
			</li>
			<li>
				<p>
                    Is an 
					<strong>
                        output
					</strong>
                    &nbsp;variable that is used to establish the depth value for the current fragment.
				</p>
			</li>
			<li>
				<p>
                    It is a 
                    <code>float</code>
                    .
				</p>
			</li>
			<li>
				<p>
                    If depth buffering is enabled and no shader writes to 
                    <code>gl_FragDepth</code>
                    , then the fixed function value for depth will be used (this value is contained in the z component of 
                    <code>gl_FragCoord</code>
                    ) otherwise, the value written to 
                    <code>gl_FragDepth</code>
                    &nbsp;is used.
				</p>
			</li>
			<li>
				<p>
                    If a shader statically assigns to 
                    <code>gl_FragDepth</code>
                    , then the value of the fragment's depth may be undefined for executions of the shader that don't take that path. That is, if the set of linked fragment shaders statically contain a write to 
                    <code>gl_FragDepth</code>
                    , then it is responsible for always writing it.
				</p>
			</li>
			<li>
				<p>
                    Available in all versions of glsl.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
            <code>gl_FragCoord</code>
		</p>
		<ul>
			<li>
				<p>
                    Available only in the fragment shader.
				</p>
			</li>
			<li>
				<p>
                    Is an 
					<strong>
                        input
					</strong>
                    &nbsp;variable that contains the window relative coordinate (x, y, z, 1/w) values for the fragment.
				</p>
			</li>
			<li>
				<p>
                    This value is the result of fixed functionality that interpolates primitives after vertex processing to generate fragments.
				</p>
			</li>
			<li>
				<p>
					<strong>
                        Multi-sampling
					</strong>
                    :
				</p>
				<ul>
					<li>
						<p>
                            If multi-sampling, this value can be for any location within the pixel, or one of the fragment samples.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
					<strong>
                        Depth
					</strong>
                    :
				</p>
				<ul>
					<li>
						<p>
                            The 
                            <code>z</code>
                            &nbsp;component is the depth value that would be used for the fragment's depth if no shader contained any writes to 
                            <code>gl_FragDepth</code>
                            .
						</p>
					</li>
					<li>
						<p>
                            <code>gl_FragCoord.z</code>
                            &nbsp;is the depth value of the fragment that your shader is operating on, 
							<strong>
                                not
							</strong>
                            &nbsp;the current value of the depth buffer at the fragment position.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
					<strong>
                        Changing the origin, by redeclaring it
					</strong>
                    :
				</p>
				<ul>
					<li>
						<p>
                            <code>gl_FragCoord</code>
                            &nbsp;may be redeclared with the additional layout qualifier identifiers 
                            <code>origin_upper_left</code>
                            &nbsp;or 
                            <code>pixel_center_integer</code>
                            . By default, 
                            <code>gl_FragCoord</code>
                            &nbsp;assumes a lower-left origin for window coordinates and assumes pixel centers are located at half-pixel centers.
						</p>
					</li>
					<li>
						<p>
							<em>
                                Example
							</em>
                            :
						</p>
						<ul>
							<li>
								<p>
                                    The 
                                    <code>(x, y)</code>
                                    &nbsp;location 
                                    <code>(0.5, 0.5)</code>
                                    &nbsp;is returned for the lower-left-most pixel in a window. The origin of 
                                    <code>gl_FragCoord</code>
                                    &nbsp;may be changed by redeclaring 
                                    <code>gl_FragCoord</code>
                                    &nbsp;with the 
                                    <code>origin_upper_left</code>
                                    &nbsp;identifier. The values returned can also be shifted by half a pixel in both x and y by 
                                    <code>pixel_center_integer</code>
                                    &nbsp;so it appears the pixels are centered at whole number pixel offsets. This moves the (x, y) value returned by 
                                    <code>gl_FragCoord</code>
                                    &nbsp;of 
                                    <code>(0.5, 0.5)</code>
                                    &nbsp;by default to 
                                    <code>(0.0, 0.0)</code>
                                    &nbsp;with 
                                    <code>pixel_center_integer</code>
                                    .
								</p>
							</li>
						</ul>
					</li>
					<li>
						<p>
                            If 
                            <code>gl_FragCoord</code>
                            &nbsp;is redeclared in any fragment shader in a program, it must be redeclared in all fragment shaders in that program that have static use of 
                            <code>gl_FragCoord</code>
                            .
						</p>
					</li>
					<li>
						<p>
                            Redeclaring 
                            <code>gl_FragCoord</code>
                            &nbsp;with any accepted qualifier affects only 
                            <code>gl_FragCoord.x</code>
                            &nbsp;and 
                            <code>gl_FragCoord.y</code>
                            .
						</p>
					</li>
					<li>
						<p>
                            It has no effect on rasterization, transformation or any other part of the OpenGL pipeline or language features.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Available in all versions of glsl.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Depth Execution Modes
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    (2025-10-07) Vulkan supports this.
				</p>
				<ul>
					<li>
						<p>
                            Conservative depth can be enabled in Vulkan the same way as in OpenGL (i.e. with 
                            <code>layout(depth_&lt;condition&gt;) out float gl_FragDepth</code>
                            ).
						</p>
					</li>
					<li>
						<p>
                            You can test it and look at the SPIR-V output.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    Allows for a possible optimization for implementations that relies on an early depth test to be run before the fragment.
				</p>
			</li>
		</ul>
<pre><code class="language-glsl" data-lang="glsl">// assume it may be modified in any way
layout(depth_any) out float gl_FragDepth;

// assume it may be modified such that its value will only increase
layout(depth_greater) out float gl_FragDepth;

// assume it may be modified such that its value will only decrease
layout(depth_less) out float gl_FragDepth;

// assume it will not be modified
layout(depth_unchanged) out float gl_FragDepth;
</code></pre>
		<ul>
			<li>
				<p>
                    <code>GL_ARB_conservative_depth</code>
                    .
				</p>
			</li>
			<li>
				<p>
                    Violating the conditionâ€‹ yields undefined behavior.
				</p>
			</li>
			<li>
				<p>
                    The layout qualifier for 
                    <code>gl_FragDepth</code>
                    &nbsp;specifies constraints on the final value of 
                    <code>gl_FragDepth</code>
                    &nbsp;written by any shader invocation.&nbsp;&nbsp;GL implementations may perform optimizations assuming that the depth test fails (or passes)&nbsp;&nbsp;for a given fragment if all values of 
                    <code>gl_FragDepth</code>
                    &nbsp;consistent with the layout qualifier would fail (or pass).&nbsp;&nbsp;If the final value of 
                    <code>gl_FragDepth</code>
                    &nbsp;is inconsistent with its layout qualifier, the result of the depth test for the corresponding fragment is undefined.&nbsp;&nbsp;However, no error will be generated in this case.&nbsp;&nbsp;When the depth test passes and depth writes are enabled, the value written to the depth buffer is always the value of 
                    <code>gl_FragDepth</code>
                    , whether or not it is consistent with the layout qualifier.
				</p>
			</li>
			<li>
				<p>
                    <code>&lt;depth_any&gt;</code>
				</p>
				<ul>
					<li>
						<p>
                            The shader compiler will note any assignment to 
                            <code>gl_FragDepth</code>
                            &nbsp;modifying it in an unknown way, and depth testing will always be performed after the shader has executed.
						</p>
					</li>
					<li>
						<p>
                            By default, 
                            <code>gl_FragDepth</code>
                            &nbsp;assumes the 
                            <code>&lt;depth_any&gt;</code>
                            &nbsp;layout qualifier.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    <code>&lt;depth_greater&gt;</code>
				</p>
				<ul>
					<li>
						<p>
                            The GL will assume that the final value of 
                            <code>gl_FragDepth</code>
                            &nbsp;is greater than or equal to the fragment's interpolated depth value, as given by the 
                            <code>&lt;z&gt;</code>
                            &nbsp;component of 
                            <code>gl_FragCoord</code>
                            .
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    <code>&lt;depth_less&gt;</code>
				</p>
				<ul>
					<li>
						<p>
                            The GL will assume that any modification of 
                            <code>gl_FragDepth</code>
                            &nbsp;will only decrease its value.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    <code>&lt;depth_unchanged&gt;</code>
				</p>
				<ul>
					<li>
						<p>
                            The shader compiler will honor any modification to 
                            <code>gl_FragDepth</code>
                            , but the rest of the GL assume that 
                            <code>gl_FragDepth</code>
                            &nbsp;is not assigned a new value.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    If 
                    <code>gl_FragDepth</code>
                    &nbsp;is redeclared in any fragment shader in a program, it must be redeclared in all fragment shaders in that program that have static assignments to 
                    <code>gl_FragDepth</code>
                    . All redeclarations of 
                    <code>gl_FragDepth</code>
                    &nbsp;in all fragment shaders in a single program must have the same set of qualifiers. Within any shader, the first redeclarations of 
                    <code>gl_FragDepth</code>
                    &nbsp;must appear before any use of 
                    <code>gl_FragDepth</code>
                    . The built-in 
                    <code>gl_FragDepth</code>
                    &nbsp;is only predeclared in fragment shaders, so redeclaring it in any other shader stage will be illegal.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h5
	id="depth-test" >
    Depth Test
</h5>
<ul>
	<li>
		<p>
            If the test fails, the fragment is discarded.
		</p>
	</li>
	<li>
		<p>
            If the test passes, the depth attachment will be updated with the fragmentâ€™s output depth.
		</p>
	</li>
</ul>
<h5
	id="depth-bias" >
    Depth Bias
</h5>
<ul>
	<li>
		<p>
            Requires the 
            <code>VkPhysicalDeviceFeatures::depthBiasClamp</code>
            &nbsp;feature to be supported otherwise 
            <code>VkPipelineRasterizationStateCreateInfo::depthBiasClamp</code>
            &nbsp;must be 
            <code>0.0f</code>
            .
		</p>
	</li>
	<li>
		<p>
            The depth bias values can be set 
			<a
				href="https://docs.vulkan.org/guide/latest/dynamic_state.html" 
				class="external-link" 
				target="_blank" >
                dynamically
			</a>
            &nbsp;using 
            <code>DYNAMIC_STATE_DEPTH_BIAS</code>
            &nbsp;or the 
            <code>DYNAMIC_STATE_DEPTH_BIAS_ENABLE_EXT</code>
            &nbsp;from 
			<a
				href="https://registry.khronos.org/vulkan/specs/latest/man/html/EXT_extended_dynamic_state2.html" 
				class="external-link" 
				target="_blank" >
                EXT_extended_dynamic_state2
			</a>
            .
		</p>
	</li>
	<li>
		<p>
            The rasterizer can alter the depth values by adding a constant value or biasing them based on a fragmentâ€™s slope.
		</p>
	</li>
	<li>
		<p>
            Controls whether to bias fragment depth values.
		</p>
	</li>
	<li>
		<p>
            This is sometimes used for shadow mapping.
		</p>
	</li>
	<li>
		<p>
			<strong>
                Bias Constant Factor
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Is a scalar factor controlling the constant depth value added to each fragment.
				</p>
			</li>
			<li>
				<p>
                    Scales the parameter 
                    <code>r</code>
                    &nbsp;of the depth attachment
				</p>
			</li>
			<li>
				<p>
                    &quot;
                    <code>depthBiasConstantFactor</code>
                    &nbsp;is a scalar factor controlling the constant depth value added to each fragment. The value is in floating point and a typical value seems to be around 2.0-3.0.&quot;
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Bias Slope Factor
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Is a scalar factor applied to a fragmentâ€™s slope in depth bias calculations.
				</p>
			</li>
			<li>
				<p>
                    Scales the maximum depth slope 
                    <code>m</code>
                    &nbsp;of the polygon.
				</p>
			</li>
			<li>
				<p>
                    &quot;I stumbled upon some Vulkan samples that used a much smaller constant bias, but the slope bias was quite high. However, because the slope bias has a much larger weight than the constant one it pretty much worked the same.&quot;
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Bias Clamp
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    Is the maximum (or minimum) depth bias of a fragment.
				</p>
			</li>
			<li>
				<p>
                    The scaled terms 
                    <code>depthBiasConstantFactor</code>
                    &nbsp;and 
                    <code>depthBiasSlopeFactor</code>
                    &nbsp;are summed to produce a value which is then clamped to a minimum or maximum value specified.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h5
	id="depth-bounds" >
    Depth Bounds
</h5>
<ul>
	<li>
		<p>
            If the value is not within the depth bounds, the coverage mask is set to zero.
		</p>
	</li>
	<li>
		<p>
            Requires the 
            <code>VkPhysicalDeviceFeatures::depthBounds</code>
            &nbsp;feature to be supported.
		</p>
	</li>
	<li>
		<p>
            The depth bound values can be set 
			<a
				href="https://docs.vulkan.org/guide/latest/dynamic_state.html" 
				class="external-link" 
				target="_blank" >
                dynamically
			</a>
            &nbsp;using 
            <code>DYNAMIC_STATE_DEPTH_BOUNDS</code>
            &nbsp;or the 
            <code>DYNAMIC_STATE_DEPTH_BOUNDS_TEST_ENABLE_EXT</code>
            &nbsp;from 
			<a
				href="https://registry.khronos.org/vulkan/specs/latest/man/html/EXT_extended_dynamic_state.html" 
				class="external-link" 
				target="_blank" >
                EXT_extended_dynamic_state
			</a>
            .
		</p>
	</li>
</ul>
<h5
	id="depth-clamp" >
    Depth Clamp
</h5>
<ul>
	<li>
		<p>
            Controls whether to clamp the fragmentâ€™s depth values as described in Depth Test.
		</p>
	</li>
	<li>
		<p>
            Before the sampleâ€™s 
            <code>Zf</code>
            &nbsp;is compared to 
            <code>Za</code>
            , 
            <code>Zf</code>
            &nbsp;is clamped to 
            <code>[min(n,f), max(n,f)]</code>
            , where 
            <code>n</code>
            &nbsp;and 
            <code>f</code>
            &nbsp;are the 
            <code>minDepth</code>
            &nbsp;and 
            <code>maxDepth</code>
            &nbsp;depth range values of the viewport used by this fragment, respectively.
		</p>
	</li>
	<li>
		<p>
            If set to 
            <code>TRUE</code>
            , then fragments that are beyond the near and far planes are clamped to them as opposed to discarding them.
		</p>
	</li>
	<li>
		<p>
            This is useful in some special cases like 
			<em>
                shadow maps
			</em>
            .
		</p>
	</li>
	<li>
		<p>
            Requires the 
            <code>VkPhysicalDeviceFeatures::depthClamp</code>
            &nbsp;feature to be supported.
		</p>
	</li>
</ul>
<h3
	id="depth-attachment" >
    Depth Attachment
</h3>
<h5
	id="clearing" >
    Clearing
</h5>
<ul>
	<li>
		<p>
            It is always better to clear a depth buffer at the start of the pass with 
            <code>loadOp</code>
            &nbsp;set to 
            <code>ATTACHMENT_LOAD_OP_CLEAR</code>
            .
		</p>
	</li>
	<li>
		<p>
            Depth images can also be cleared outside a render pass using 
            <code>vkCmdClearDepthStencilImage</code>
            .
		</p>
	</li>
	<li>
		<p>
            When clearing, notice that 
            <code>VkClearValue</code>
            &nbsp;is a union and 
            <code>VkClearDepthStencilValue depthStencil</code>
            &nbsp;should be set instead of the color clear value.
		</p>
	</li>
</ul>
<h5
	id="multi-sampling" >
    Multi-sampling
</h5>
<ul>
	<li>
		<p>
            The following post-rasterization occurs as a &quot;per-sample&quot; operation. This means when doing multisampling with a color attachment, any &quot;depth buffer&quot; 
            <code>VkImage</code>
            &nbsp;used as well must also have been created with the same 
            <code>VkSampleCountFlagBits</code>
            &nbsp;value.
		</p>
	</li>
	<li>
		<p>
            A 
			<em>
                coverage mask
			</em>
            &nbsp;is generated for each fragment, based on which samples within that fragment are determined to be within the area of the primitive that generated the fragment.
		</p>
	</li>
	<li>
		<p>
            If a fragment operation results in all bits of the coverage mask being 
            <code>0</code>
            , the fragment is discarded.
		</p>
	</li>
	<li>
		<p>
			<em>
                Resolving
			</em>
            :
		</p>
		<ul>
			<li>
				<p>
                    It is possible in Vulkan using the 
					<a
						href="https://docs.vulkan.org/guide/latest/extensions/cleanup.html#khr_depth_stencil_resolve" 
						class="external-link" 
						target="_blank" >
                        KHR_depth_stencil_resolve
					</a>
                    &nbsp;extension (promoted to Vulkan core in 1.2) to resolve multisampled depth/stencil attachments in a subpass in a similar manner as for color attachments.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h3
	id="depth-image" >
    Depth Image
</h3>
<h5
	id="formats" >
    Formats
</h5>
<ul>
	<li>
		<p>
            Nvidia: Prefer using 
            <code>D24_UNORM_S8_UINT</code>
            &nbsp;or 
            <code>D32_SFLOAT</code>
            &nbsp;depth formats, 
            <code>D32_SFLOAT_S8_UINT</code>
            &nbsp;is not optimal.
		</p>
	</li>
	<li>
		<p>
            There are a few different depth formats and an implementation may expose support for in Vulkan.
		</p>
	</li>
	<li>
		<p>
            For 
			<strong>
                reading
			</strong>
            &nbsp;from a depth image only 
            <code>D16_UNORM</code>
            &nbsp;and 
            <code>D32_SFLOAT</code>
            &nbsp;are required to support being read via sampling or blit operations.
		</p>
	</li>
	<li>
		<p>
            For 
			<strong>
                writing
			</strong>
            &nbsp;to a depth image 
            <code>FORMAT_D16_UNORM</code>
            &nbsp;is required to be supported. From here at least one of (
            <code>FORMAT_X8_D24_UNORM_PACK32</code>
            &nbsp;
			<strong>
                or
			</strong>
            &nbsp;
            <code>FORMAT_D32_SFLOAT</code>
            ) 
			<strong>
                and
			</strong>
            &nbsp;(
            <code>FORMAT_D24_UNORM_S8_UINT</code>
            &nbsp;
			<strong>
                or
			</strong>
            &nbsp;
            <code>FORMAT_D32_SFLOAT_S8_UINT</code>
            ) must also be supported. This will involve some extra logic when trying to find which format to use if 
			<strong>
                both
			</strong>
            &nbsp;the depth and stencil are needed in the same format.
		</p>
	</li>
</ul>
<h5
	id="aspect-masks" >
    Aspect Masks
</h5>
<ul>
	<li>
		<p>
            Required when performing operations such as image barriers or clearing.
		</p>
	</li>
	<li>
		<p>
            <code>DEPTH</code>
		</p>
	</li>
</ul>
<h5
	id="sharing-mode" >
    Sharing Mode
</h5>
<ul>
	<li>
		<p>
            Nvidia: 
            <code>VkSharingMode</code>
            &nbsp;is ignored by the driver, so 
            <code>SHARING_MODE_CONCURRENT</code>
            &nbsp;incurs no overhead relative to 
            <code>SHARING_MODE_EXCLUSIVE</code>
            .
		</p>
	</li>
</ul>
<h5
	id="layout-transition" >
    Layout Transition
</h5>
<pre><code class="language-c" data-lang="c">// Example of going from undefined layout to a depth attachment to be read and written to

// Core Vulkan example
srcAccessMask = 0;
dstAccessMask = ACCESS_DEPTH_STENCIL_ATTACHMENT_READ | ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE;
sourceStage = PIPELINE_STAGE_TOP_OF_PIPE;
destinationStage = PIPELINE_STAGE_EARLY_FRAGMENT_TESTS | PIPELINE_STAGE_LATE_FRAGMENT_TESTS;

// KHR_synchronization2
srcAccessMask = ACCESS_2_NONE_KHR;
dstAccessMask = ACCESS_2_DEPTH_STENCIL_ATTACHMENT_READ_KHR | ACCESS_2_DEPTH_STENCIL_ATTACHMENT_WRITE_KHR;
sourceStage = PIPELINE_STAGE_2_NONE_KHR;
destinationStage = PIPELINE_STAGE_2_EARLY_FRAGMENT_TESTS_KHR | PIPELINE_STAGE_2_LATE_FRAGMENT_TESTS_KHR;
</code></pre>
<ul>
	<li>
		<p>
            If unsure to use only early or late fragment tests for your application, use both.
		</p>
	</li>
</ul>
<h5
	id="copying" >
    Copying
</h5>
<ul>
	<li>
		<p>
            Nvidia: Copy both depth and stencil to avoid a slow path for copying.
		</p>
	</li>
</ul>
<h5
	id="reverse-depth-buffer" >
    Reverse Depth Buffer
</h5>
<ul>
	<li>
		<p>
            See 
            <a href="/studies/Graphics Programming/Graphics and Shaders/Graphics and Shaders.html#projection-matrix">
            Graphics Programming, Shaders#Projection Matrix
            </a>
            .
		</p>
	</li>
</ul>
<h3
	id="normal-reconstruction-from-depth" >
    Normal Reconstruction from Depth
</h3>
<ul>
	<li>
		<p>
            You can infer the normals by calculating the derivatives on x and y between pixels of the depth buffer.
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://www.reddit.com/r/GraphicsProgramming/comments/14fevz1/faster_to_calculate_normals_from_depth_than_to/" 
				class="external-link" 
				target="_blank" >
                Discussion
			</a>
            .
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://wickedengine.net/2019/09/improved-normal-reconstruction-from-depth/" 
				class="external-link" 
				target="_blank" >
                Implementation - Wicked Engine (JÃ¡nos TurÃ¡nszki (turanszkij))
			</a>
            .
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://atyuwen.github.io/posts/normal-reconstruction/" 
				class="external-link" 
				target="_blank" >
                Implementation - Yuwen Wu (atyuwen)
			</a>
            .
		</p>
	</li>
	<li>
		<p>
			<strong>
                Need
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    &quot;In screen-space decals rendering, normal buffer is required to reject pixels projected onto near-perpendicular surfaces. But back then I was working on a forward pipeline, so no normal buffer was outputted. It seemed the best choice was to reconstruct it directly from depth buffer, as long as we could avoid introducing errors, which was not easy though.&quot;
				</p>
			</li>
			<li>
				<p>
                    So, for a forward shading, this 
					<em>
                        could
					</em>
                    &nbsp;be necessary.
				</p>
			</li>
			<li>
				<p>
                    It could be avoided if saving the normals in a texture to be sent to a post-processing pass; aka, if introduced a bit of deferred in the forward renderer.
				</p>
			</li>
		</ul>
	</li>
	<li>
		<p>
			<strong>
                Performance
			</strong>
            :
		</p>
		<ul>
			<li>
				<p>
                    There's a lot of discussion if this is worthwhile. On a deferred renderer, this could be good, but the gain in performance is not obvious. It really depends on how it was implemented.
				</p>
			</li>
		</ul>
	</li>
</ul>
<h3
	id="stencil" >
    Stencil
</h3>
<ul>
	<li>
		<p>
            <img src="assets/image_20250929094247.png" width="350" >
            .
		</p>
	</li>
	<li>
		<p>
            1 or 0, if have a fragment from our object.
		</p>
	</li>
</ul>
<h5
	id="used-in" >
    Used in
</h5>
<ul>
	<li>
		<p>
            Portals.
		</p>
	</li>
	<li>
		<p>
            Mirrors.
		</p>
	</li>
	<li>
		<p>
            Outlining
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=SlV7nxqCX8Y" 
				class="external-link" 
				target="_blank" >
                Non-Euclidean - demo
			</a>
            .
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://www.youtube.com/watch?v=xj3Pi6QmXQc" 
				class="external-link" 
				target="_blank" >
                See through - demo
			</a>
            .
		</p>
	</li>
</ul>
<h3
	id="stencil-attachment" >
    Stencil Attachment
</h3>
<ul>
	<li>
		<p>
            The 
            <code>PipelineRenderingCreateInfo</code>
            &nbsp;asks for a 
            <code>stencilAttachmentFormat</code>
            , and 
            <code>RenderingInfo</code>
            &nbsp;asks for 
            <code>pStencilAttachment</code>
            .
		</p>
	</li>
	<li>
		<p>
            This is for cases where you want separate depth and stencil images, instead of merged together, like when having a depth image with 
            <code>D24_UNORM_S8_UINT</code>
            , where the 
            <code>S8_UINT</code>
            &nbsp;is for the stencil.
		</p>
	</li>
	<li>
		<p>
			<a
				href="https://registry.khronos.org/vulkan/specs/latest/man/html/KHR_separate_depth_stencil_layouts.html" 
				class="external-link" 
				target="_blank" >
                <code>KHR_separate_depth_stencil_layouts</code>
			</a>
            .
		</p>
		<ul>
			<li>
				<p>
                    Core in Vulkan 1.2.
				</p>
			</li>
			<li>
				<p>
                    This extension allows image memory barriers for 'depth+stencil' images to have just one of the 
                    <code>IMAGE_ASPECT_DEPTH</code>
                    &nbsp;or 
                    <code>IMAGE_ASPECT_STENCIL</code>
                    &nbsp;aspect bits set, rather than require both. This allows their layouts to be set independently. Image Layouts 
                    <code>IMAGE_LAYOUT_DEPTH_ATTACHMENT_OPTIMAL</code>
                    , 
                    <code>IMAGE_LAYOUT_DEPTH_READ_ONLY_OPTIMAL</code>
                    , 
                    <code>IMAGE_LAYOUT_STENCIL_ATTACHMENT_OPTIMAL</code>
                    , or 
                    <code>IMAGE_LAYOUT_STENCIL_READ_ONLY_OPTIMAL</code>
                    &nbsp;can be used.
				</p>
			</li>
			<li>
				<p>
                    To support depth+stencil images with different layouts for the depth and stencil aspects, the depth+stencil attachment interface has been updated to support a separate layout for stencil.
				</p>
			</li>
			<li>
				<p>
					<a
						href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkPhysicalDeviceSeparateDepthStencilLayoutsFeaturesKHR.html" 
						class="external-link" 
						target="_blank" >
                        <code>VkPhysicalDeviceSeparateDepthStencilLayoutsFeatures</code>
					</a>
                    .
				</p>
				<ul>
					<li>
						<p>
                            Structure describing whether the implementation can do depth and stencil image barriers separately.
						</p>
					</li>
					<li>
						<p>
                            It's just a struct with a bool telling if the feature is supported.
						</p>
					</li>
				</ul>
			</li>
			<li>
				<p>
                    <s>For render passes / subpasses</s>:
				</p>
				<ul>
					<li>
						<p>
							<a
								href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkAttachmentDescriptionStencilLayoutKHR.html" 
								class="external-link" 
								target="_blank" >
                                <code>VkAttachmentDescriptionStencilLayout</code>
							</a>
                            .
						</p>
						<ul>
							<li>
								<p>
                                    Deprecated in Vulkan 1.4.
								</p>
							</li>
							<li>
								<p>
                                    Extends 
									<a
										href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkAttachmentDescription2.html" 
										class="external-link" 
										target="_blank" >
                                        <code>VkAttachmentDescription2</code>
									</a>
                                    .
								</p>
								<ul>
									<li>
										<p>
                                            Deprecated in Vulkan 1.4.
										</p>
									</li>
								</ul>
							</li>
						</ul>
					</li>
					<li>
						<p>
							<a
								href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkAttachmentReferenceStencilLayoutKHR.html" 
								class="external-link" 
								target="_blank" >
                                <code>VkAttachmentReferenceStencilLayout</code>
							</a>
                            .
						</p>
						<ul>
							<li>
								<p>
                                    Not deprecated.
								</p>
							</li>
							<li>
								<p>
                                    Extends 
									<a
										href="https://registry.khronos.org/vulkan/specs/latest/man/html/VkAttachmentReference2.html" 
										class="external-link" 
										target="_blank" >
                                        <code>VkAttachmentReference2</code>
									</a>
                                    .
								</p>
								<ul>
									<li>
										<p>
                                            Deprecated in Vulkan 1.4.
										</p>
									</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</li>
</ul>
<h5
	id="formats" >
    Formats
</h5>
<ul>
	<li>
		<p>
            <code>S8_UINT</code>
		</p>
		<ul>
			<li>
				<p>
                    It makes sense, as it's the same format used for stencil in the depth format 
                    <code>D24_UNORM_S8_UINT</code>
                    .
				</p>
			</li>
		</ul>
	</li>
</ul>

				</article>
			</main>
			<footer
				id="central-footer" >
                ðŸ§‘â€ðŸ’» built and copyrighted by
				<a
					href="https://github.com/caioraphael1" 
					target="_blank" >
                    Caio Raphael
				</a>
                ðŸ“… 2025-2026 ðŸš€
			</footer>
		</main>
		<script
			src="/static/studies.30472.js" >
		</script>
	</body>
</html>
